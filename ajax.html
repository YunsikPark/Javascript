<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AJAX</title>
    <script src="node_modules/axios/dist/axios.min.js"></script>
</head>
<body>
    <script>

        // localhost:8000/api/post/ (<- 끝에 slash빠지면 오류남)
        // 에 GET요청을 보내고, 결과를 console.log에 출력

    // # 01_
        // var httpRequest;
        // httpRequest = new XMLHttpRequest();
        // httpRequest.onreadystatechange = function() {
        //     // state가 변경될 때 마다 실행할 함수내용
        //     if (httpRequest.readyState == 4) {
        //         console.log(httpRequest.responseText);
        //     }
        // };
        // httpRequest.open('GET', 'http://localhost:8000/api/post/', true);
        // httpRequest.send();


    // # 02_
        // var httpRequest;
        // httpRequest = new XMLHttpRequest();
        // httpRequest.onreadystatechange = function() {
        //     if (httpRequest.readyState == 4) {
        //         var postList = JSON.parse(httpRequest.response);
        //         for(var i = 0; i < postList.length; i++) {
        //             console.log(postList[i]);
        //         }
        //     }
        // };
        // httpRequest.open('GET', 'http://localhost:8000/api/post/', true);
        // httpRequest.send();

//        JS HTTP라이브러리
//            axios를 사용하도록 리펙토링
//            (예전에는 jquery를 사용했지만 이제는 axios가 대세)

    // # 03_

        // var httpRequest;
        // httpRequest = new XMLHttpRequest();
        // httpRequest.onreadystatechange = function() {
        //     if (httpRequest.readyState == 4) {
        //         if (httpRequest.status = 200) {
        //             var postList = JSON.parse(httpRequest.response);
        //             for(var i = 0; i < postList.length; i++) {
        //                 console.log(postList[i]);
        //                 var curPost = postList[i];
        //                 // 새 div 요소를 생성
        //                 var div = document.createElement('div');
        //                 // 생성한 div내부의 HTML에 h1과 img태그를 추가
        //                 div.innerHTML = '<h1>[pk:' +curPost.author.username +']' + '</h1>';
        //                 div.innerHTML = '<img src="' + curPost.photo + '" alt="" width="100%"/>';
        //                 // 생성한 div내부의 HTML에 h1과 img태그를 추가
        //                 document.body.appendChild(div);
        //                 // createElement
        //                 // appendChild
        //                 // 각 post를 순회할 때마다,
        //                 // 하나의 div 요소를 만들어 document에 추가
        //             }
        //         } else {
        //             console.log('request error')
        //             console.log(httpRequest.response)
        //         }
        //     }
        // };
        // httpRequest.open('GET', 'http://localhost:8000/api/post/');
        // httpRequest.send();


    // # 04_axios

    axios.get('http://localhost:8000/api/post/')
    .then(function (response){
        console.log(response.data);
        var postList = response.data;
        for(var i = 0; i < postList.length; i++) {
            createPost(postList[i]);
        }
    })
    .catch(function (error) {
        console.log(error);
    });


    function createPost(post) {
        var div = document.createElement('div');
        // 생성한 div내부의 HTML에 h1과 img태그를 추가
        div.innerHTML = '<h1>[pk:' +post.pk +']' + '</h1>';
        div.innerHTML = '<img src="' + post.photo + '" alt="" width="100%"/>';
        // 생성한 div내부의 HTML에 h1과 img태그를 추가
        document.body.appendChild(div);
        // createElement
        // appendChild
        // 각 post를 순회할 때마다,
        // 하나의 div 요소를 만들어 document에 추가
        }


    </script>
</body>
</html>
